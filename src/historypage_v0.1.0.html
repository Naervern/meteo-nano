<!DOCTYPE html>
<html>
<header>

</header>
<main>

</main>
<script>
// Creates new WebSocket object with a wss URI as the parameter
const socket = new WebSocket('wss://game.example.com/ws/updates');

// Fired when a connection with a WebSocket is opened
socket.onopen = function () {
  setInterval(function() {
    if (socket.bufferedAmount == 0)
      socket.send(getUpdateData());
  }, 50);
};

// Fired when data is received through a WebSocket
socket.onmessage = function(event) {
  handleUpdateData(event.data);
  ()=>{
    let length = data.readUInt8(0);
    //let buffer = new SharedArrayBuffer(16*length.to);
    //let row0 = new ;
    //document.getElementById("data").innerHTML +=
    
    for (i in range(length){
      //let t, tp, h, p, oc, c;
      //include row time, 4 bytes in seconds
      main.innerHTML += "\n" + data.readUIntBE(1, 4) + ";";
      //temperature, 2 bytes int in centi-celsius
      main.innerHTML += (data.readIntBE(5, 2)/100) + ";";
      //humidity, 2 bytes int in deci-millis
      main.innerHTML += (data.readUIntBE(7, 2)/100) + ";";
      //pressure, 2 bytes int in Pa with a -500 hPa offset
      main.innerHTML += (data.readUIntBE(9, 2)/100+500) + ";";
      //TVOC, 2 bytes int in ppb
      main.innerHTML += data.readUIntBE(1, 2) + ";";

      }
    }
};

// Fired when a connection with a WebSocket is closed
socket.onclose = function(event) {
  onSocketClose(event);
};

// Fired when a connection with a WebSocket has been closed because of an error
socket.onerror = function(event) {
  onSocketError(event);
};
</script>
</html>